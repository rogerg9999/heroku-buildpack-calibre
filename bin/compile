#!/usr/bin/env bash
# bin/compile <build-dir> <cache-dir>

# fail fast
set -e

# parse and derive params
BUILD_DIR=$1
VENDOR_DIR="vendor"
DOWNLOAD_URL="https://raw.githubusercontent.com/kovidgoyal/calibre/master/setup/linux-installer.py"
cd $BUILD_DIR
mkdir -p $VENDOR_DIR
cd $VENDOR_DIR
mkdir -p calibre
cd calibre


echo "-----> Fetching Calibre"

curl --silent --output linux-installer.py $DOWNLOAD_URL > /dev/null 2>&1

echo "-----> Installing Calibre"

python2.7 -c "execfile(\"./linux-installer.py\"); main(install_dir=\"$BUILD_DIR\")" > /dev/null 2>&1

echo "-----> Setting up path"

export PATH="$BUILD_DIR/calibre:$PATH"

echo "-----> Calibre install done"
